<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard - Nexus Management</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/dashboard/dashboard.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">Nexus Management</div>
    <ul class="nav-links">
      <li><a href="/">Home</a></li>
      <li><a href="/#plans">Plans</a></li>
      <li><a href="/auth/logout" class="logout-link"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
    </ul>
  </nav>

  <!-- Dashboard Hero -->
  <section class="dashboard-hero">
    <div class="hero-content fade-in">
      <h1><i class="fa-solid fa-gauge-high"></i> Dashboard</h1>
      <p class="tagline">Welcome back, <span id="display-username">User</span></p>
      <p class="subtext">Manage your ER:LC staff tools and community from one place.</p>
    </div>
  </section>

  <!-- Dashboard Main Content -->
  <section class="dashboard-content">
    <div class="dashboard-grid">
      
      <!-- Account Info Card -->
      <div class="dashboard-card account-card reveal">
        <div class="card-header">
          <h3><i class="fa-solid fa-user-circle"></i> Account Information</h3>
        </div>
        <div class="card-body">
          <div class="info-row">
            <span class="info-label"><i class="fa-solid fa-user"></i> Username:</span>
            <span class="info-value" id="username">Loading...</span>
          </div>
          <div class="info-row">
            <span class="info-label"><i class="fa-solid fa-id-card"></i> Account ID:</span>
            <span class="info-value account-id" id="accountID">Loading...</span>
            <button class="copy-btn" onclick="copyAccountID()" title="Copy Account ID">
              <i class="fa-solid fa-copy"></i>
            </button>
          </div>
          <div class="info-row">
            <span class="info-label"><i class="fa-solid fa-calendar"></i> Member Since:</span>
            <span class="info-value" id="memberSince">Loading...</span>
          </div>
        </div>
        <div class="card-footer warning">
          <i class="fa-solid fa-triangle-exclamation"></i>
          <span>Never share your Account ID â€” it grants access to your account.</span>
        </div>
      </div>

      <!-- Quick Stats Card -->
      <div class="dashboard-card stats-card reveal">
        <div class="card-header">
          <h3><i class="fa-solid fa-chart-line"></i> Quick Stats</h3>
        </div>
        <div class="card-body stats-grid">
          <div class="stat-item stat-single">
            <div class="stat-icon">
              <i class="fa-solid fa-server"></i>
            </div>
            <div class="stat-info">
              <span class="stat-value">0</span>
              <span class="stat-label">Active Servers</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Server Management Card -->
      <div class="dashboard-card feature-card reveal">
        <div class="card-header">
          <h3><i class="fa-solid fa-server"></i> Server Management</h3>
        </div>
        <div class="card-body">
          <p class="card-desc">Create and manage your ER:LC community servers.</p>
          <button class="feature-btn" id="manageServersBtn">
            <i class="fa-solid fa-plus-circle"></i> Manage Servers
          </button>
        </div>
      </div>

    </div>
  </section>

  <!-- Footer -->
  <footer>
    <p>&copy; 2026 Nexus Management | ER:LC Staff Management</p>
  </footer>

  <script>
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    async function loadUser() {
      const accountID = getQueryParam("ID");
      const usernameEl = document.getElementById("username");
      const accountIDEl = document.getElementById("accountID");
      const displayUsernameEl = document.getElementById("display-username");
      const memberSinceEl = document.getElementById("memberSince");

      if (!accountID) {
        usernameEl.textContent = "No account ID provided";
        accountIDEl.textContent = "---";
        displayUsernameEl.textContent = "Guest";
        memberSinceEl.textContent = "---";
        return;
      }

      try {
        const res = await fetch(`/api/user/${accountID}`);
        const data = await res.json();

        if (data.error || !data.success) {
          usernameEl.textContent = "Error loading user";
          accountIDEl.textContent = "---";
          displayUsernameEl.textContent = "Unknown";
          memberSinceEl.textContent = "---";
        } else {
          const user = data.user;
          usernameEl.textContent = user.username;
          accountIDEl.textContent = user.account_id;
          displayUsernameEl.textContent = user.username;
          
          // Format date
          if (user.created_at) {
            const date = new Date(user.created_at);
            memberSinceEl.textContent = date.toLocaleDateString('en-US', { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            });
          } else {
            memberSinceEl.textContent = "Recently";
          }
        }
      } catch (err) {
        console.error(err);
        usernameEl.textContent = "Failed to fetch user data";
        accountIDEl.textContent = "---";
        displayUsernameEl.textContent = "Error";
        memberSinceEl.textContent = "---";
      }
    }

    function copyAccountID() {
      const accountID = document.getElementById("accountID").textContent;
      if (accountID && accountID !== "Loading..." && accountID !== "---") {
        navigator.clipboard.writeText(accountID).then(() => {
          const btn = document.querySelector('.copy-btn');
          const icon = btn.querySelector('i');
          icon.className = 'fa-solid fa-check';
          btn.style.background = '#10b981';
          
          setTimeout(() => {
            icon.className = 'fa-solid fa-copy';
            btn.style.background = '';
          }, 2000);
        });
      }
    }

    // Scroll reveal animation
    function revealOnScroll() {
      const reveals = document.querySelectorAll('.reveal');
      reveals.forEach((el, index) => {
        const rect = el.getBoundingClientRect();
        const isVisible = rect.top < window.innerHeight - 100;
        if (isVisible) {
          setTimeout(() => {
            el.classList.add('active');
          }, index * 100);
        }
      });
    }

    window.addEventListener('scroll', revealOnScroll);
    window.addEventListener('load', () => {
      loadUser();
      revealOnScroll();
      
      // Fade in animation
      const fadeElements = document.querySelectorAll('.fade-in');
      fadeElements.forEach(el => {
        el.classList.add('active');
      });

      // Set up manage servers button with account ID
      const manageServersBtn = document.getElementById('manageServersBtn');
      if (manageServersBtn) {
        const accountID = getQueryParam("ID");
        if (accountID) {
          manageServersBtn.onclick = function() {
            window.location.href = `/main/servers.html?ID=${accountID}`;
          };
        }
      }
    });
  </script>
</body>
</html>
