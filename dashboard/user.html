<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard - Nexus Management</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <header>
    <h1>Nexus Management</h1>
    <div class="user-info">
      <img id="avatar" src="" alt="User Avatar">
      <span id="username"></span>
      <button id="logoutBtn">Logout</button>
    </div>
  </header>

  <section class="hero">
    <h2>Welcome back, <span id="displayName"></span>!</h2>
    <p>Your plan: <span id="planBadge"></span></p>
  </section>

  <section class="stats">
    <div class="card">
      <h3>Infractions</h3>
      <p id="infractionsCount">0</p>
    </div>
    <div class="card">
      <h3>Promotions</h3>
      <p id="promotionsCount">0</p>
    </div>
    <div class="card">
      <h3>Announcements</h3>
      <p id="announcementsCount">0</p>
    </div>
  </section>

  <footer>
    <p>&copy; 2026 Nexus Management</p>
  </footer>

  <script>
    async function loadDashboard() {
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get("token");

      if (!token) {
        alert("No session token found. Please log in again.");
        window.location.href = "/";
        return;
      }

      const res = await fetch("/api/user", {
        headers: { Authorization: token }
      });

      if (!res.ok) {
        alert("Session expired. Please log in again.");
        window.location.href = "/";
        return;
      }

      const user = await res.json();

      document.getElementById("avatar").src = user.avatar;
      document.getElementById("username").textContent = user.username + "#" + user.discriminator;
      document.getElementById("displayName").textContent = user.username;
      document.getElementById("planBadge").textContent = user.plan;

      document.getElementById("infractionsCount").textContent = user.infractions || 0;
      document.getElementById("promotionsCount").textContent = user.promotions || 0;
      document.getElementById("announcementsCount").textContent = user.announcements || 0;

      document.getElementById("logoutBtn").onclick = () => {
        window.location.href = "/logout?token=" + token;
      };
    }

    loadDashboard();
  </script>
</body>
</html>
